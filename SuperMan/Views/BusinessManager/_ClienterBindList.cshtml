@using ETS.Data.PageData
@*@using Ets.Model.DataModel.Finance*@
@using Ets.Model.DomainModel.Business
@*@using ETS.Util;
@using NPOI.HSSF.Record.Formula.Functions*@
<table border="0" cellspacing="0" cellpadding="0" class="tbstyle" width="900">
    <thead>
        <tr class="tdbg">
            <th>编号</th>
            <th>骑士姓名</th>
            <th>骑士电话</th>
            <th>时间</th>
            <th>状态</th>
            <th>操作人</th>
            <th>操作</th>
    </thead>
    <tbody>
        @{
            var businessClienterRelationList = ViewBag.businessClienterRelationList as PageInfo<BusinessClienterRelationModel>;
            if (businessClienterRelationList != null && businessClienterRelationList.Records.Count > 0)
            {
                var i = 0;
                foreach (var item in businessClienterRelationList.Records)
                {
                    i++;
                    <tr id="@item.Id">
                        <td>@i</td>
                        <td>@item.ClienterName</td>
                        <td>@item.PhoneNo</td>
                        <td>@item.UpdateTime</td>
                        <td>@(item.IsBind==0?"未绑定":"已绑定")</td>
                        <td>@item.UpdateBy</td>
                        <td>
                            @if (SuperMan.App_Start.UserContext.Current.HasAuthority(24))
                            {
                                if (item.IsBind == 0)
                                {
                                    <a href="javascript:funModifyClienterBind(@item.BusinessId,@item.ClienterId,1,'是否绑定？')">绑定</a>
                                }
                                else
                                {
                                    <a href="javascript:funModifyClienterBind(@item.BusinessId,@item.ClienterId,0,'是否解除绑定？')">解除绑定</a>
                                }
                            }
                            @if (SuperMan.App_Start.UserContext.Current.HasAuthority(52))
                            {
                                if (item.IsEnable == 0)
                                {
                                    <a href="javascript:void(0)" style="color:gray">删除</a>
                                }
                                else
                                {
                                    <a href="javascript:funRemoveClienterBind(@item.BusinessId,@item.ClienterId)">删除</a>
                                }

                            }
                        </td>
                    </tr>
                }
            }
        }
    </tbody>
</table>
@{
    if (businessClienterRelationList != null)
    {
        ViewBag.ActionName = "PostClienterBindManage";
        @Html.Partial("~/views/shared/PagerControl.cshtml", businessClienterRelationList)
    }
}

<script type="text/javascript">
    ///修改骑士绑定
    function funModifyClienterBind(businessId, clienterId, isBind,msg) {
        if (!window.confirm(msg)) {
            return;
        }
        var paramaters = { "businessId": businessId, "clienterId": clienterId, "isBind": isBind };
        var url = "/BusinessManager/ModifyClienterBind";
        $.ajax({
            type: 'POST',
            url: url,
            data: paramaters,
            success: function (result) {
                if (result.IsSuccess) {
                    alert(result.Message);
                    window.location.href = "/BusinessManager/ClienterBindManage?businessId=" + businessId;
                } else {
                    alert(result.Message);
                }
            }
        });
    }
    ///删除骑士绑定
    function funRemoveClienterBind(businessId, clienterId) {
        if (!window.confirm("是否删除绑定？")) {
            return;
        }
        var paramaters = { "businessId": businessId, "clienterId": clienterId };
        var url = "/BusinessManager/RemoveClienterBind";
        $.ajax({
            type: 'POST',
            url: url,
            data: paramaters,
            success: function (result) {
                if (result.IsSuccess) {
                    alert(result.Message);
                    window.location.href = "/BusinessManager/ClienterBindManage?businessId=" + businessId;
                } else {
                    alert(result.Message);
                }
            }
        });
    }
</script>


