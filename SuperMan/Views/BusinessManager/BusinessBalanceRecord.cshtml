@model Ets.Model.DomainModel.Finance.BusinessWithdrawFormModel
@{
    Layout = "~/Views/Shared/_LayoutNew.cshtml";
}
@using ETS.Util;
<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.8.2.js"></script>
<script src="~/Scripts/jquery-ui-1.8.20.js"></script>
<script src="~/Scripts/jquery.ui.datepicker-zh-CN.js"></script>
<div style="width:1000px">
    @{
        var strstatus = "";
        if (Model.Status == 1)
        {
            strstatus = "待审核";
        }
        else if (Model.Status == 2)
        {
            strstatus = "审核通过";
        }
        else if (Model.Status == 3)
        {
            strstatus = "打款完成";
        }
        else if (Model.Status == -1)
        {
            strstatus = "审核拒绝";
        }
        else if (Model.Status == -2)
        {
            strstatus = "打款失败";
        }
    }
    <h2 class="crumbs">
        您所在位置：商户 > 商户管理 > 收支记录
    </h2>
    <table class="tbstyle222" border="0" style="font-size:14px;font-weight:bold;line-height:300%;width:900px ">
        <tr class="trclass">
            <td>商户名称：@Model.BusinessName</td>
            <td>电话：@Model.BusinessPhoneNo</td>
            <td></td>
            <td></td>
        </tr>
        <tr class="trclass">
            <td>当前余额：￥@ParseHelper.ToSplitByPercentile(false, Model.BalancePrice)</td>
            <td>累计提款：￥@ParseHelper.ToSplitByPercentile(false, Model.HasWithdrawPrice)</td>
            <td></td>
            <td></td>
        </tr>
        <tr class="trclass">
            <td>开户行:@Model.OpenBank</td>
            <td>开户支行：@Model.OpenSubBank</td>
            <td>账户名:@Model.TrueName</td>
            <td>银行账号:@Model.WithwardNo</td>
        </tr>
    </table>
    <div class="SearchMd">
        <span class="">交易类型: </span>
        <select name="withdrawStatus" class="selectw" id="withdrawStatus" style="width:157px">
            <option value="0">全部</option>
            <option value="1">订单餐费</option>
            <option value="2">配送费</option>
            <option value="3">提现</option>
            <option value="4">充值</option>
            <option value="5">提现失败返现</option>
        </select>
        <span class="">提款单号: </span>
        <br />
        <input id="withwardNo" type="text" name="withwardNo" />
        <span class="">申请提款日期: </span>
        <input id="withdrawDateStart" readonly="readonly" type="text" name="withdrawDateStart" />
        <span class="">到: </span>
        <input id="withdrawDateEnd" readonly="readonly" type="text" name="withdrawDateEnd" />
        <input type="button" value="查 询" class="searchBtn" id="btnAuditOk" />
        <input type="button" value="导 出" class="searchBtn" id="btnAuditRefuse" />
    </div>
    <div style="float:left;width:900px;padding-top:30px" class="control-group">
        <table border="0" cellspacing="0" cellpadding="0" class="tbstyle" width="900">
            <thead>
                <tr class="tdbg">
                    <th>交易类型</th>
                    <th>任务单号/交易流水号</th>
                    <th>余额</th>
                    <th>状态</th>
                    <th>时间</th>
                    <th>操作人</th>
            </thead>
            <tbody>
                @{
                    var businessBalanceRecordList = ViewBag.businessBalanceRecord as List<Ets.Model.DataModel.Finance.BusinessBalanceRecord>;
                    var i = 0;
                    var statusDes = "";
                    foreach (var item in businessBalanceRecordList)
                    {
                        if (item.Status == 1)
                        {
                            statusDes = "待审核";
                        }
                        else if (item.Status == 2)
                        {
                            statusDes = "审核通过";
                        }
                        else if (item.Status == 3)
                        {
                            statusDes = "打款完成";
                        }
                        else if (item.Status == -1)
                        {
                            statusDes = "审核拒绝";
                        }
                        else if (item.Status == -2)
                        {
                            statusDes = "打款失败";
                        }
                        i++;
                        <tr id="@item.Id">
                            <td>@item.OperatTime</td>
                            <td>@statusDes</td>
                            <td>@item.Operator</td>
                            <td>@item.Remark</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
@*审核拒绝弹框*@
<div class="selectSupplierDish">
    <div class="add-openbox add-form" id="WithdrawAuditRefuseShow" style="width:480px">
        <fieldset>
            <div class="control-group">
                <div style="width:480px;font-size:16px"><center>是否拒绝打款1000.00元？</center></div>
                <div class="controls" style="width:480px">
                    <div style="width:75px">拒绝原因:</div>
                    <div style="width:480px">
                        <textarea cols="60" rows="5" id="txtWithdrawAuditRefuse"></textarea>
                        <p class="help-block"></p>
                    </div>
                </div>
            </div>
        </fieldset>
        <p class="btnbox">
            <input value="确认" type="button" id="btnWithdrawAuditRefuse" class="yesBtn" />
            <input value="关闭" type="button" class="J_closebox qxBtn" />
        </p>
    </div>
</div>
<script type="text/javascript">
    var adminjs = new adminglass(); //实例化后台类
    ///审核通过
    $("#btnAuditOk").click(function () {
        if (!window.confirm("确认要提交审核？")) {
            return;
        }
        var withwardId = $('#hidWithwardId').val();
        var paramaters = { "withwardId": withwardId };
        var url = "/BusinessWithdraw/WithdrawAuditOk";
        $.ajax({
            type: 'POST',
            url: url,
            data: paramaters,
            success: function (result) {
                if (result.IsSuccess) {
                    alert(result.Message);
                    window.location.href = "/BusinessWithdraw/BusinessWithdraw";
                } else {
                    alert(result.Message);
                }
            }
        });

    });
    //审核拒绝弹框
    $("#btnAuditRefuse").click(function () {
        adminjs.openwinbox('#WithdrawAuditRefuseShow');

    });

    //审核拒绝提交
    $("#btnWithdrawAuditRefuse").click(function () {
        if (!window.confirm("确认要审核拒绝？")) {
            return;
        }
        var auditFailedReason = $('#txtWithdrawAuditRefuse').val();
        var withwardId = $('#hidWithwardId').val();
        var paramaters = { "withwardId": withwardId, "auditFailedReason": auditFailedReason };
        var url = "/BusinessWithdraw/WithdrawAuditRefuse";
        $.ajax({
            type: 'POST',
            url: url,
            data: paramaters,
            success: function (result) {
                if (result.IsSuccess) {
                    alert(result.Message);
                    window.location.href = "/BusinessWithdraw/BusinessWithdraw";
                } else {
                    alert(result.Message);
                }
            }
        });
    });
    //关闭弹层
    $('.J_closebox').click(function () {
        adminjs.closewinbox('.add-openbox');
        return false;
    });
</script>









