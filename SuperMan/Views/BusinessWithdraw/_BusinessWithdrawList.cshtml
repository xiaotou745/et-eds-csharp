@model ETS.Data.PageData.PageInfo<Ets.Model.DomainModel.Finance.BusinessWithdrawFormModel>
@using ETS.Util;
<script src="~/Scripts/view/orderList.js"></script>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="tbstyle">
    <thead>
        <tr class="tdbg">
            <th>编号</th>
            <th>提款单号</th>
            <th>商户名称</th>
            <th>电话</th>
            <th>提现前余额</th>
            <th>提现前可提现余额</th>
            <th>提现金额</th>
            @*<th>提现后余额</th>*@
            <th>状态</th>
            <th>申请时间</th>
            @*<th>审核人</th>
                <th>审核时间</th>
                <th>打款人</th>
                <th>打款时间</th>
                <th>审核拒绝原因</th>
                <th>打款失败原因</th>*@
            <th>操作</th>
        </tr>
    </thead>
    <tbody>
        @{
            var i = 0;
            if (Model != null && Model.Records.Count > 0)
            {
                foreach (var item in Model.Records)
                {
                    i++;
                    <tr id="@item.Id">
                        <td>@i</td>
                        <td><a href="/BusinessWithdraw/BusinessWithdrawDetail?withwardId=@item.Id" style=" text-decoration-line: underline">@item.WithwardNo</a></td>
                        <td>@item.BusinessName</td>
                        <td>@item.BusinessPhoneNo</td>
                        <td>@ParseHelper.ToSplitByPercentile(false, item.BalancePrice)</td>
                        <td>@ParseHelper.ToSplitByPercentile(false, item.AllowWithdrawPrice)</td>
                        <td style="color:green;font-weight:600">@ParseHelper.ToSplitByPercentile(false, item.Amount)</td>
                        @*<td>@ParseHelper.ToSplitByPercentile(false, item.Balance)</td>*@
                        @{
                    var strstatus = "";
                    if (item.Status == 1)
                    {
                        strstatus = "待审核";
                    }
                    else if (item.Status == 2)
                    {
                        strstatus = "审核通过";
                    }
                    else if (item.Status == 3)
                    {
                        strstatus = "打款完成";
                    }
                    else if (item.Status == -1)
                    {
                        strstatus = "审核拒绝";
                    }
                    else if (item.Status == -2)
                    {
                        strstatus = "打款失败";
                    }
                        }
                        <td>@strstatus</td>
                        <td>@item.WithdrawTime</td>
                        @*<td>@item.Auditor</td>
                            <td>@item.AuditTime</td>
                            <td>@item.Payer</td>
                            <td>@item.PayTime</td>
                            <td>@item.AuditFailedReason</td>
                            <td>@item.PayFailedReason</td>*@
                        <td>
                            @*@if (item.Status == 1)
                                {

                                }*@
                            <a href="javascript:void(0)" onclick="funWithdrawAuditOk(@item.Id)">审核通过</a>
                            <a href="javascript:void(0)" onclick="funWithdrawAuditRefuse(@item.Id)">拒绝</a>
                            <a href="javascript:void(0)" onclick="funPayOk(@item.Id)">确认打款</a>
                            <a href="/BusinessWithdraw/BusinessWithdrawDetail?withwardId=@item.Id">打款失败</a>
                        </td>
                    </tr>
                }
            }
        }
    </tbody>
</table>
<div class="selectSupplierDish">
    <div class="add-openbox add-form" id="WithdrawAuditRefuseShow" style="width:480px">
        <fieldset>
            <div class="control-group">
                <div style="width:480px;font-size:16px"><center>是否拒绝打款1000.00元？</center></div>
                <div class="controls" style="width:480px">
                    <div style="width:75px">拒绝原因:</div>
                    <div style="width:480px">
                        <textarea cols="60" rows="5" id="txtWithdrawAuditRefuse"></textarea>
                        <p class="help-block"></p>
                    </div>
                </div>
            </div>
        </fieldset>
        <p class="btnbox">
            <input value="确认" type="button" id="btnWithdrawAuditRefuse" class="yesBtn" />
            <input value="关闭" type="button" class="J_closebox qxBtn" />
        </p>
    </div>
</div>
@{
    if (Model != null)
    {
        ViewBag.ActionName = "PostBusinessWithdraw";
        @Html.Partial("~/views/shared/PagerControl.cshtml", Model)
    }
}
<script type="text/javascript">
    var adminjs = new adminglass(); //实例化后台类

    ///审核通过
    function funWithdrawAuditOk(withwardId) {
        if (!window.confirm("确认要提交审核？")) {
            return;
        }
        var paramaters = { "withwardId": withwardId };
        var url = "/BusinessWithdraw/WithdrawAuditOk";
        $.ajax({
            type: 'POST',
            url: url,
            data: paramaters,
            success: function (result) {
                if (result.IsSuccess) {
                    alert(result.Message);
                    window.location.href = "/BusinessWithdraw/BusinessWithdraw";
                } else {
                    alert(result.Message);
                }
            }
        });
    }
    function funPayOk(withwardId) {
        if (!window.confirm("确认要提交打款？")) {
            return;
        }
        var paramaters = { "withwardId": withwardId };
        var url = "/BusinessWithdraw/PayOk";
        $.ajax({
            type: 'POST',
            url: url,
            data: paramaters,
            success: function (result) {
                if (result.IsSuccess) {
                    alert(result.Message);
                    window.location.href = "/BusinessWithdraw/BusinessWithdraw";
                } else {
                    alert(result.Message);
                }
            }
        });
    }
    function funWithdrawAuditRefuse(withwardId) {
        if (!window.confirm("确认要审核拒绝？")) {
            return;
        }
        adminjs.openwinbox('#WithdrawAuditRefuseShow');
        var AuditFailedReason=$('#txtWithdrawAuditRefuse').val();
        var paramaters = { "withwardId": withwardId };
        var url = "/BusinessWithdraw/PayOk";
        $.ajax({
            type: 'POST',
            url: url,
            data: paramaters,
            success: function (result) {
                if (result.IsSuccess) {
                    alert(result.Message);
                    window.location.href = "/BusinessWithdraw/BusinessWithdraw";
                } else {
                    alert(result.Message);
                }
            }
        });
    }
    function funWithdrawAuditRefuse(withwardId) {
        adminjs.openwinbox('#WithdrawAuditRefuseShow');
    }
    $("#btnWithdrawAuditRefuse").click(function () {
        if (!window.confirm("确认要审核拒绝？")) {
            return;
        }
        var auditFailedReason=$('#txtWithdrawAuditRefuse').val();
        var paramaters = { "withwardId": withwardId,"auditFailedReason":auditFailedReason };
        var url = "/BusinessWithdraw/WithdrawAuditRefuse";
        $.ajax({
            type: 'POST',
            url: url,
            data: paramaters,
            success: function (result) {
                if (result.IsSuccess) {
                    alert(result.Message);
                    window.location.href = "/BusinessWithdraw/BusinessWithdraw";
                } else {
                    alert(result.Message);
                }
            }
        });
    });
    //关闭弹层
    $('.J_closebox').click(function () {
        adminjs.closewinbox('.add-openbox');
        return false;
    });
</script>
