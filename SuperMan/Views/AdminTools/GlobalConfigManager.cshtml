@using Ets.Model.DomainModel.GlobalConfig
@{
    Layout = "~/Views/Shared/_LayoutNew.cshtml";
    GlobalConfigModel globalConfigModel = ViewBag.GloglConfig;
}
<script src="~/Scripts/jquery-2.1.1.js"></script>
<script type="text/javascript" src="/Scripts/jquery.unobtrusive-ajax.min.js"></script>
<div class="zpManage zpSh">
    <h2 class="crumbs">
        您所在位置：管理员工具 > 公共配置管理
    </h2>
    <div class="SearchMd">
        <table border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td>
                    <span>骑士有待完成任务经纬度上传时间间隔:</span>
                    <input type="text" name="hasUnFinishedOrderUploadTimeInterval" value="@globalConfigModel.HasUnFinishedOrderUploadTimeInterval" id="hasUnFinishedOrderUploadTimeInterval" style="width: 100px" />秒
                    <input type="hidden" name="oldHasUnFinishedOrderUploadTimeInterval" value="@globalConfigModel.HasUnFinishedOrderUploadTimeInterval" id="oldHasUnFinishedOrderUploadTimeInterval" />
                </td>
                <td>
                    <span>骑士没有待完成任务经纬度上传时间间隔:</span>
                    <input type="text" name="allFinishedOrderUploadTimeInterval" value="@globalConfigModel.AllFinishedOrderUploadTimeInterval" id="allFinishedOrderUploadTimeInterval" style="width: 100px" />秒
                    <input type="hidden" name="oldAllFinishedOrderUploadTimeInterval" value="@globalConfigModel.AllFinishedOrderUploadTimeInterval" id="oldAllFinishedOrderUploadTimeInterval" />
                </td>
            </tr>
            <tr>
                <td>
                    <span>订单推动区域半径:</span>
                    <input type="text" name="pushRadius" value="@globalConfigModel.PushRadius" id="pushRadius" style="width: 100px" />千米
                    <input type="hidden" name="oldPushRadius" value="@globalConfigModel.PushRadius" id="oldPushRadius" />
                </td>
                <td>
                    <span>骑士订单列表每页显示条数:</span>
                    <input type="text" name="clienterOrderPageSize" value="@globalConfigModel.ClienterOrderPageSize" id="clienterOrderPageSize" style="width: 100px" />条
                    <input type="hidden" name="oldClienterOrderPageSize" value="@globalConfigModel.ClienterOrderPageSize" id="oldClienterOrderPageSize" />
                </td>
            </tr>
            <tr>
                <td>
                    <span>商家专属骑士接单响应时间:</span>
                    <input type="text" name="exclusiveOrderTime" value="@globalConfigModel.ExclusiveOrderTime" id="exclusiveOrderTime" style="width: 100px" />分
                    <input type="hidden" name="oldExclusiveOrderTime" value="@globalConfigModel.ExclusiveOrderTime" id="oldExclusiveOrderTime" />
                </td>
                <td>
                    <span>骑士完成任务时间限制:</span>
                    <input type="text" name="completeTimeSet" value="@globalConfigModel.CompleteTimeSet" id="completeTimeSet" style="width: 100px" />分
                    <input type="hidden" name="oldCompleteTimeSet" value="@globalConfigModel.CompleteTimeSet" id="oldCompleteTimeSet" />
                </td>
            </tr>
            <tr>
                <td>
                    <span>雇主任务时间限制:</span>
                    <input type="text" name="employerTaskTimeSet" value="@globalConfigModel.EmployerTaskTimeSet" id="employerTaskTimeSet" style="width: 100px" />分
                    <input type="hidden" name="oldEmployerTaskTimeSet" value="@globalConfigModel.EmployerTaskTimeSet" id="oldEmployerTaskTimeSet" />
                </td>
                <td>
                    <span>提现小于等于X元支付手续费:</span>
                    <input type="text" name="employerTaskTimeSet" value="@globalConfigModel.ClienterWithdrawCommissionAccordingMoney" id="clienterWithdrawCommissionAccordingMoney" style="width: 100px" />元
                    <input type="hidden" name="oldEmployerTaskTimeSet" value="@globalConfigModel.ClienterWithdrawCommissionAccordingMoney" id="oldClienterWithdrawCommissionAccordingMoney" />
                </td>
            </tr>
            <tr>
                <td>
                    <span>无效订单判定时累计完成订单数量:</span>
                    <input type="text" name="orderCountSetting" value="@globalConfigModel.OrderCountSetting" id="orderCountSetting" style="width: 100px" />个
                    <input type="hidden" name="oldOrderCountSetting" value="@globalConfigModel.OrderCountSetting" id="oldOrderCountSetting" />
                </td>
                <td>
                    <span>无效订单判定时抢单点和完成点的距离:</span>
                    <input type="text" name="grabToCompleteDistance" value="@globalConfigModel.GrabToCompleteDistance" id="grabToCompleteDistance" style="width: 100px" />米
                    <input type="hidden" name="oldGrabToCompleteDistance" value="@globalConfigModel.GrabToCompleteDistance" id="oldGrabToCompleteDistance" />
                </td>
            </tr>
            <tr>
                <td>
                    <span>易宝支付手续费金额:</span>
                    <input type="text" name="withdrawCommission" value="@globalConfigModel.WithdrawCommission" id="withdrawCommission" style="width: 100px" />元
                    <input type="hidden" name="oldWithdrawCommission" value="@globalConfigModel.WithdrawCommission" id="oldWithdrawCommission" />
                </td>
                <td>
                    <input type="button" value="提交修改" class="searchBtn" id="btnCommit" />
                </td>
            </tr>
            <tr>
                <td>
                    <span>商家经纬度上传时间间隔:</span>
                    <input type="text" name="businessUploadTimeInterval" value="@globalConfigModel.BusinessUploadTimeInterval" id="businessUploadTimeInterval" style="width: 100px" />秒
                    <input type="hidden" name="oldBusinessUploadTimeInterval" value="@globalConfigModel.BusinessUploadTimeInterval" id="oldBusinessUploadTimeInterval" />
                </td>
            </tr>
        </table>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        $("#btnCommit").click(function () {
            var hasUnFinishedOrderUploadTimeInterval = $("#hasUnFinishedOrderUploadTimeInterval").val(); //骑士有待完成任务经纬度上传时间间隔
            var allFinishedOrderUploadTimeInterval = $("#allFinishedOrderUploadTimeInterval").val(); //骑士没有待完成任务经纬度上传时间间隔
            var pushRadius = $("#pushRadius").val(); //推送半径
            var clienterOrderPageSize = $("#clienterOrderPageSize").val(); //骑士订单列表每页显示条数
            var exclusiveOrderTime = $("#exclusiveOrderTime").val(); //商家专属骑士接单响应时间
            var completeTimeSet = $("#completeTimeSet").val(); //骑士完成任务时间限制
            var employerTaskTimeSet = $("#employerTaskTimeSet").val(); //雇主任务时间限制
            var clienterWithdrawCommissionAccordingMoney = $("#clienterWithdrawCommissionAccordingMoney").val(); //骑士提现小于等于X元支付手续费
            var withdrawCommission = $("#withdrawCommission").val(); //易宝支付手续费金额
            var orderCountSetting = $("#orderCountSetting").val(); //无效订单判定时累计完成订单数量
            var grabToCompleteDistance = $("#grabToCompleteDistance").val(); //无效订单判定时抢单点和完成点的距离
            var businessUploadTimeInterval = $("#businessUploadTimeInterval").val(); //商家经纬度上传时间间隔

            var oldHasUnFinishedOrderUploadTimeInterval = $("#oldHasUnFinishedOrderUploadTimeInterval").val(); //骑士有待完成任务经纬度上传时间间隔（之前）
            var oldAllFinishedOrderUploadTimeInterval = $("#oldAllFinishedOrderUploadTimeInterval").val(); //骑士没有待完成任务经纬度上传时间间隔（之前）
            var oldPushRadius = $("#oldPushRadius").val(); //推送半径（之前）
            var oldClienterOrderPageSize = $("#oldClienterOrderPageSize").val(); //骑士订单列表每页显示条数（之前）
            var oldExclusiveOrderTime = $("#oldExclusiveOrderTime").val(); //商家专属骑士接单响应时间（之前）
            var oldCompleteTimeSet = $("#oldCompleteTimeSet").val(); //骑士完成任务时间限制（之前）
            var oldEmployerTaskTimeSet = $("#oldEmployerTaskTimeSet").val(); //雇主任务时间限制（之前）
            var oldClienterWithdrawCommissionAccordingMoney = $("#oldClienterWithdrawCommissionAccordingMoney").val(); //骑士提现小于等于X元支付手续费（之前）
            var oldWithdrawCommission = $("#oldWithdrawCommission").val(); //易宝支付手续费金额（之前）
            var oldOrderCountSetting = $("#oldOrderCountSetting").val(); //无效订单判定时累计完成订单数量
            var oldGrabToCompleteDistance = $("#oldGrabToCompleteDistance").val(); //无效订单判定时抢单点和完成点的距离
            var oldBusinessUploadTimeInterval = $("#oldBusinessUploadTimeInterval").val(); //商家经纬度上传时间间隔（之前）


            var pageOk = true;
            $(":text").each(function (index, obj) {
                if ($(obj).val() == "") {
                    pageOk = false;
                    return false;
                }
            });
            if (!pageOk) {
                alert("页面存在未输入的值!");
                return;
            }
            if (isNaN(orderCountSetting)) {
                alert("无效订单判定时累计完成订单数量请输入正确的数字!");
                return;
            }
            if (orderCountSetting < 0) {
                alert("无效订单判定时累计完成订单数量请输入大于零的值!");
                return;
            }
            if (isNaN(grabToCompleteDistance)) {
                alert("无效订单判定时抢单点和完成点的距离请输入正确的数字!");
                return;
            }
            if (grabToCompleteDistance < 0) {
                alert("无效订单判定时抢单点和完成点的距离请输入大于零的值!");
                return;
            }
            if (isNaN(hasUnFinishedOrderUploadTimeInterval)) {
                alert("请输入正确的数字!");
                return;
            }
            if (hasUnFinishedOrderUploadTimeInterval < 0) {
                alert("请输入大于零的值!");
                return;
            }

            if (isNaN(allFinishedOrderUploadTimeInterval)) {
                alert("请输入正确的数字!");
                return;
            }
            if (allFinishedOrderUploadTimeInterval < 0) {
                alert("请输入大于零的值!");
                return;
            }

            if (isNaN(businessUploadTimeInterval)) {
                alert("请输入正确的数字!");
                return;
            }
            if (businessUploadTimeInterval < 0) {
                alert("请输入大于零的值!");
                return;
            }

            if (isNaN(clienterWithdrawCommissionAccordingMoney)) {
                alert("请输入正确的数字!");
                return;
            }
            if (clienterWithdrawCommissionAccordingMoney < 0) {
                alert("请输入大于零的值!");
                return;
            }
            if (isNaN(pushRadius)) {
                alert("请输入正确的数字!");
                return;
            }
            if (pushRadius < 0) {
                alert("请输入大于零的值!");
                return;
            }
            if (isNaN(clienterOrderPageSize)) {
                alert("请输入正确的数字!");
                return;
            }
            if (clienterOrderPageSize < 0) {
                alert("请输入大于零的值!");
                return;
            }
            if (clienterOrderPageSize > 100) {
                alert("最大值不能超过100!");
                return;
            }
            if (isNaN(exclusiveOrderTime)) {
                alert("请输入正确的商家专属骑士接单响应时间!");
                return;
            }
            if (exclusiveOrderTime < 1 || exclusiveOrderTime > 120) {
                alert("商家专属骑士接单响应时间为1-120分钟之间!");
                return;
            }

            if (completeTimeSet == "") {
                alert("骑士完成任务时间限制不能为空!");
                return;
            }

            if (isNaN(completeTimeSet)) {
                alert("骑士完成任务时间限制!");
                return;
            }
            if (completeTimeSet < 0 || completeTimeSet > 60) {
                alert("骑士完成任务时间限制0-60分钟之间!");
                return;
            }
            if (employerTaskTimeSet == "") {
                alert("雇主任务时间限制不能为空!");
                return;
            }
            var reg = /^\d{1,2}:\d{2}-\d{1,2}:\d{2}$/;
            if (!reg.test(employerTaskTimeSet)) {
                alert('对不起，您输入的雇主任务时间格式不正确!');
                return;
            }
            var reg2 = /^\d+$/;
            if (withdrawCommission == "" || !reg2.test(withdrawCommission)) {
                alert('易宝支付手续费金额不合法!');
                return;
            }

            if (withdrawCommission==oldWithdrawCommission&&
                clienterWithdrawCommissionAccordingMoney == oldClienterWithdrawCommissionAccordingMoney &&
	            hasUnFinishedOrderUploadTimeInterval == oldHasUnFinishedOrderUploadTimeInterval &&
	            allFinishedOrderUploadTimeInterval == oldAllFinishedOrderUploadTimeInterval &&
	            pushRadius == oldPushRadius &&
	            clienterOrderPageSize == oldClienterOrderPageSize &&
	            exclusiveOrderTime == oldExclusiveOrderTime &&
	            completeTimeSet == oldCompleteTimeSet &&
	            employerTaskTimeSet == oldEmployerTaskTimeSet &&
	            orderCountSetting == oldOrderCountSetting &&
                grabToCompleteDistance == oldGrabToCompleteDistance && 
                businessUploadTimeInterval == oldBusinessUploadTimeInterval) {
                alert("没有需要修改的信息!");
                return;
            }
            
            if (confirm("确定提交修改?")) {
                var pars = {
                    "withdrawCommission": withdrawCommission,
                    "clienterWithdrawCommissionAccordingMoney": clienterWithdrawCommissionAccordingMoney,
                    "hasUnFinishedOrderUploadTimeInterval": hasUnFinishedOrderUploadTimeInterval,
                    "allFinishedOrderUploadTimeInterval": allFinishedOrderUploadTimeInterval,
                    "pushRadius": pushRadius,
                    "clienterOrderPageSize": clienterOrderPageSize,
                    "exclusiveOrderTime": exclusiveOrderTime,
                    "completeTimeSet": completeTimeSet,
                    "employerTaskTimeSet": employerTaskTimeSet,
                    "orderCountSetting": orderCountSetting,
                    "grabToCompleteDistance": grabToCompleteDistance,
                    "businessUploadTimeInterval": businessUploadTimeInterval
                };
                var url = "/AdminTools/ModifyGlobalConfig";
                $.ajax({
                    type: 'POST',
                    url: url,
                    data: pars,
                    success: function (result) {
                        if (result.IsSuccess) {
                            alert(result.Message);
                            window.location.href = "/AdminTools/GlobalConfigManager/";
                        } else {
                            alert(result.Message);
                        }
                    },
                    error: function (responseData) {
                        alert(responseData.responseText);
                    }
                });
            }

        });
    })
</script>
