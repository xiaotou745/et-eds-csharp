@model ClienterManage
@using SuperManCommonModel.Models;
@using SuperManBusinessLogic.CommonLogic
@using SuperManBusinessLogic.Group_Logic
@{
    ViewBag.Title = "Order";
}

<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.8.2.js"></script>
<script src="~/Scripts/jquery-ui-1.8.20.js"></script>
<script src="~/Scripts/jquery.ui.datepicker-zh-CN.js"></script>
<link href="~/Content/jQuery-File-Upload/css/jquery.fileupload-ui.css" rel="stylesheet" />
<script type="text/javascript" src="~/Content/jQuery-File-Upload/js/jquery.ui.widget.js"></script>
<script type="text/javascript" src="~/Content/jQuery-File-Upload/js/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="~/Content/jQuery-File-Upload/js/jquery.fileupload.js"></script>
<div class="zpManage zpSh">
    <h2 class="crumbs">
        您所在位置：超人 > 超人管理
    </h2>
    <div class="SearchMd">
        <table border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td>
                    <span class="">超人名称: </span>
                    <input id="txtSuperManName" type="tel" />
                    <span class="">审核状态: </span>
                    <select name="select" class="selectw" id="superManStatus" style="width:143px">
                        <option value="-1">全部</option>
                        <option value="1">审核通过</option>
                        <option value="0">被拒绝</option>
                        <option value="2">未审核</option>
                        <option value="3">审核中</option>
                    </select>
                    <span class="">超人电话: </span>
                    <input id="txtSuperManPhone" type="text" />
                    <input id="txtGroupId" type="hidden" value="@ViewBag.txtGroupId" />
                    <input type="submit" value="查询" class="searchBtn" id="btnSearch" />
                    <input id="btnAdd" class="searchBtn" type="button" value="新增超人">
                </td>
            </tr>
        </table>
    </div>
    <div class="bd clearfix" id="dataList">
        @Html.Partial("_SuperManManagerList", Model.clienterManageList)
    </div>
</div>

<!--新增超人弹出窗部分  add by caoheyang20140228-->
<div class="selectSupplierDish">
    <div class="add-openbox add-form" id="AddSuperManShow" style="width:500px">
        <h2>
            <p id="statusUnFin">新增超人</p>
            <a class="J_closebox x_close"></a>
        </h2>
        <form class="form-horizontal" role="form" id="AddSuperManForm" method="post" action="/SuperManManager/AddSuperMan">
            <fieldset>
                <div class="control-group">
                    <label class="control-label" for="TrueName"><span style="color:red;">*</span>姓名</label>
                    <div class="controls">
                        <input placeholder="姓名" name="TrueName" id="BoxTrueName" required="required" type="text">
                        <text id="labBoxTrueName" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="PhoneNo"><span style="color:red;">*</span>电话</label>
                    <div class="controls">
                        <input placeholder="电话" name="PhoneNo" id="BoxPhoneNo" required="required" type="text">
                        <text id="labBoxPhoneNo" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="fileUploadHand"><span style="color:red;">*</span>手持照片</label>
                    <div class="controls">
                        <input type="file" id="fileUploadHand" required="required" name="fileUploadHand" multiple>
                        <input type="hidden" id="hidHandUpload" />
                        <input type="text" id="labfileuploadHand" readonly="readonly" hidden="hidden" style="color:red" name="labfileuploadHand" value="不能为空" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="fileUpload"><span style="color:red;">*</span>照片</label>
                    <div class="controls">
                        <input type="file" placeholder="验证照片" required="required" id="fileUpload" name="fileUpload" multiple>
                        <input type="hidden" id="hidupload" />
                        <input type="text" id="labfileupload" hidden="hidden" readonly="readonly" style="color:red" name="labfileupload" value="不能为空" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="HealthCardID"><span style="color:red;">*</span>健康证ID</label>
                    <div class="controls">
                        <input placeholder="健康证ID" name="HealthCardID" id="BoxHealthCardID" required="required" type="text">
                        <text id="labHealthCardID" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label"><span style="color:red;">*</span>所属城市</label>
                    <div class="controls">
                        @Html.DropDownList("ProvinceCode", new SelectList(RegionLogic.regionLogic().GetRegionsByFid(), "Code", "Name"), "--请选择--", new { style = "width:90px", id = "BoxProvinceCode" })
                        <select name="CityCode" id="BoxCityCode" style="width:103px;">
                            l
                            <option>--城市--</option>
                        </select>
                        <text id="labBoxCode" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="BussinessID"><span style="color:red;">*</span>所属门店</label>
                    <div class="controls">
                        <select name="BussinessID" id="BoxBussinessID" style="width:198px;">
                            <option value="">--所属门店--</option>
                        </select>
                        <text id="labBoxBussinessID" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="InternalDepart">内外部门</label>
                    <div class="controls">
                        <input placeholder="内外部门" name="InternalDepart" id="BoxInternalDepart" type="text">
                    </div>

                </div>
                @if (ViewBag.txtGroupId > 0)
                {
                    <input type="hidden" id="HidGroupID" value="@ViewBag.txtGroupId" />
                }
                else
                {
                    <div class="control-group">
                        <label class="control-label" for="InternalDepart">集团信息</label>
                        <div class="controls">
                            @Html.DropDownList("HidGroupID", new SelectList(GroupLogic.groupLogic().GetGroups(), "Id", "GroupName"), "--无--")
                        </div>
                    </div>
                }
                <div class="control-group">
                    <label class="control-label" for="IDCard">身份证号</label>
                    <div class="controls">
                        <input placeholder="身份证号" name="IDCard" id="BoxIDCard" type="text">
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="Password">密码</label>
                    <div class="controls">
                        <input placeholder="默认edaisong" name="IDCard" id="BoxPassword" type="text" value="edaisong">
                    </div>
                </div>
            </fieldset>
        </form>
        <p class="btnbox">
            <input value="确认" type="button" id="btnSuperConfim" class="yesBtn" />
            <input value="关闭" type="button" class="J_closebox qxBtn" />
        </p>
    </div>
</div>



<!--骑士信息修改弹出窗部分-->
<div class="selectSupplierDish">
    <div class="add-openbox add-form" id="UpdateSuperManShow" style="width:500px">
        <h2>
            <p id="statusUnFin">超人信息修改</p>
            <a class="J_closebox x_close"></a>
        </h2>
        <form class="form-horizontal" role="form" id="UpdateSuperManForm" method="post" action="/SuperManManager/UpdateSuperMan">
            <fieldset>
                <div class="control-group">
                    <label class="control-label" for="TrueName"><span style="color:red;">*</span>姓名</label>
                    <div class="controls">
                        <input name="SupId" id="SupId" required="required" type="hidden">
                        <input placeholder="姓名" name="SupName" id="SupName" required="required" type="text">
                        <text id="labBoxSupName" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="PhoneNo"><span style="color:red;">*</span>电话</label>
                    <div class="controls">
                        <input placeholder="电话" name="SupPhoneNo" id="SupPhoneNo" required="required" type="text">
                        <text id="labBoxSupPhoneNo" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="HealthCardID"><span style="color:red;">*</span>健康证ID</label>
                    <div class="controls">
                        <input placeholder="健康证ID" name="SupHealthCardID" id="SupHealthCardID" required="required" type="text">
                        <text id="labSupHealthCardID" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label"><span style="color:red;">*</span>所属城市</label>
                    <div class="controls">
                        @Html.DropDownList("SupProvinceCode", new SelectList(RegionLogic.regionLogic().GetRegionsByFid(), "Code", "Name"), "--请选择--", new { style = "width:90px", id = "SupProvinceCode" })
                        <select name="SupCityCode" id="SupCityCode" style="width:103px;">
                            l
                            <option>--城市--</option>
                        </select>
                        <text id="labSupCityCode" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="BussinessID"><span style="color:red;">*</span>所属门店</label>
                    <div class="controls">
                        <select name="SupBussinessID" id="SupBussinessID" style="width:198px;">
                            <option value="">--所属门店--</option>
                        </select>
                        <text id="labSupBussinessID" style="color:red" hidden="hidden">不能为空</text>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="fileUploadHand">手持照片</label>
                    <div class="controls">
                        <input type="file" id="fileSupUploadHand" required="required" name="fileSupUploadHand" multiple>
                        <input type="hidden" id="hidSupHandUpload" />
                        <input type="text" id="labfileSupuploadHand" readonly="readonly" hidden="hidden" style="color:red;width:300px" name="labfileSupuploadHand" value="不能为空" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="fileUpload">照片</label>
                    <div class="controls">
                        <input type="file" placeholder="验证照片" required="required" id="fileSupUpload" name="fileSupUpload" multiple>
                        <input type="hidden" id="hidSupupload" />
                        <input type="text" id="labfileSupupload" hidden="hidden" readonly="readonly" style="color:red;width:300px" name="labfileSupupload" value="不能为空" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="InternalDepart">内外部门</label>
                    <div class="controls">
                        <input placeholder="内外部门" name="SupInternalDepart" id="SupInternalDepart" type="text">
                    </div>

                </div>
                @if (ViewBag.txtGroupId > 0)
                {
                    <input type="hidden" id="HidSupGroupID" value="@ViewBag.txtGroupId" />
                }
                else
                {
                    <div class="control-group">
                        <label class="control-label" for="InternalDepart">集团信息</label>
                        <div class="controls">
                            @Html.DropDownList("HidSupGroupID", new SelectList(GroupLogic.groupLogic().GetGroups(), "Id", "GroupName"), "--无--")
                        </div>
                    </div>
                }
                <div class="control-group">
                    <label class="control-label" for="IDCard">身份证号</label>
                    <div class="controls">
                        <input placeholder="身份证号" name="SupIDCard" id="SupIDCard" type="text">
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="Password">密码</label>
                    <div class="controls">
                        <input placeholder="登陆密码" name="SupPassword" id="SupPassword" type="text">
                    </div>
                </div>
                @{ 
                    var BusiList=SuperManBusinessLogic.B_Logic.BusiLogic.busiLogic().GetBusinessList();
                    if(BusiList.Count>0)
                    {
                        foreach(var item in BusiList)
                        {
                            <input type="checkbox" id="@item.Id" name="checkMenus" /><label>@item.Name</label>
                        }
                    }
                  }
            </fieldset>
        </form>
        <p class="btnbox">
            <input value="确认" type="button" id="btnUpdateSuperConfim" class="yesBtn" />
            <input value="关闭" type="button" class="J_closebox qxBtn" />
        </p>
    </div>
</div>
<script>
    var adminjs = new adminglass(); //实例化后台类
    var DEFAULT_PAGESIZE = 15;
    var criteria = { PagingRequest: { PageIndex: 0, PageSize: DEFAULT_PAGESIZE }, GroupId: $("#txtGroupId").val() };
    $(function () {
        $('#hidupload').val(''); //页面加载时清空隐藏域的值。
        $('#hidHandUpload').val(''); //页面加载时清空隐藏域的值。
        $("#fileUpload").val("").show();
        $("#fileUploadHand").val('').show();
        $('#hidSupupload').val('');
        $('#hidSupHandUpload').val('');
        $("#fileSupUpload").val("").show();
        $("#fileSupUploadHand").val('').show();
        //查询
        $("#btnSearch").on('click', function () {
            criteria = {
                clienterName: $("#txtSuperManName").val(),
                clienterPhone: $("#txtSuperManPhone").val(),
                status: $("#superManStatus").val(),
                GroupId: $("#txtGroupId").val(),
                PagingRequest: { PageIndex: 0, PageSize: DEFAULT_PAGESIZE }
            };
            refresh(0);
        });
        //手持身份证图片上传
        $("#fileUploadHand").fileupload({
            url: "/UploadTest/Upload",//文件上传地址，当然也可以直接写在input的data-url属性内
            formData: {},//如果需要额外添加参数可以在这里添加
            autoUpload: true,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 2000000, // 5 MB
            done: function (e, results) {
                //done方法就是上传完毕的回调函数，其他回调函数可以自行查看api
                //注意result要和jquery的ajax的data参数区分，这个对象包含了整个请求信息
                //返回的数据在result.result中，假设我们服务器返回了一个json对象
                var result = results.result;
                var picNames = result.Message.split('|');
                if (result.IsSuccess) {
                    $('#fileUploadHand').hide();
                    $('#hidHandUpload').val(picNames[0]);
                    $('#labfileuploadHand').val(picNames[0] + "-上传成功").show();
                } else {
                    alert(result.Message);
                    $('#fileUploadHand').show();
                    $('#labfileuploadHand').val(picNames[0]).show();
                }
            }
        });
        //图片上传
        $("#fileUpload").fileupload({
            url: "/UploadTest/Upload",//文件上传地址，当然也可以直接写在input的data-url属性内
            formData: {},//如果需要额外添加参数可以在这里添加
            autoUpload: true,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 2000000, // 5 MB
            done: function (e, results) {
                //done方法就是上传完毕的回调函数，其他回调函数可以自行查看api
                //注意result要和jquery的ajax的data参数区分，这个对象包含了整个请求信息
                //返回的数据在result.result中，假设我们服务器返回了一个json对象
                var result = results.result;
                var picNames = result.Message.split('|');
                if (result.IsSuccess) {
                    $('#fileUpload').hide();
                    $('#hidupload').val(picNames[0]);
                    $('#labfileupload').val(picNames[0] + "-上传成功").show();
                } else {
                    alert(result.Message);
                    $('#fileUpload').show();
                    $('#labfileupload').val(picNames[0]).show();
                }
            }
        });
        //超人信息修改手持身份证图片上传
        $("#fileSupUploadHand").fileupload({
            url: "/UploadTest/Upload",//文件上传地址，当然也可以直接写在input的data-url属性内
            formData: {},//如果需要额外添加参数可以在这里添加
            autoUpload: true,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 2000000, // 5 MB
            done: function (e, results) {
                //done方法就是上传完毕的回调函数，其他回调函数可以自行查看api
                //注意result要和jquery的ajax的data参数区分，这个对象包含了整个请求信息
                //返回的数据在result.result中，假设我们服务器返回了一个json对象
                var result = results.result;
                var picNames = result.Message.split('|');
                if (result.IsSuccess) {
                    $('#fileSupUploadHand').hide();
                    $('#hidSupHandUpload').val(picNames[0]);
                    $('#labfileSupuploadHand').val(picNames[0] + "-上传成功").show();
                } else {
                    alert(result.Message);
                    $('#fileSupUploadHand').show();
                    $('#labfileSupuploadHand').val(picNames[0]).show();
                }
            }
        });
        //超人信息修改图片上传
        $("#fileSupUpload").fileupload({
            url: "/UploadTest/Upload",//文件上传地址，当然也可以直接写在input的data-url属性内
            formData: {},//如果需要额外添加参数可以在这里添加
            autoUpload: true,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 2000000, // 5 MB
            done: function (e, results) {
                //done方法就是上传完毕的回调函数，其他回调函数可以自行查看api
                //注意result要和jquery的ajax的data参数区分，这个对象包含了整个请求信息
                //返回的数据在result.result中，假设我们服务器返回了一个json对象
                var result = results.result;
                var picNames = result.Message.split('|');
                if (result.IsSuccess) {
                    $('#fileSupUpload').hide();
                    $('#hidSupupload').val(picNames[0]);
                    $('#labfileSupupload').val(picNames[0] + "-上传成功").show();
                } else {
                    alert(result.Message);
                    $('#fileSupUpload').show();
                    $('#labfileSupupload').val(picNames[0]).show();
                }
            }
        });

        //新增超人保存按钮点击事件    add by caoheyang 20150302
        $("#btnSuperConfim").click(
            function () {
                var result = true;//验证结果
                var trueName = $('#BoxTrueName').val();//姓名
                var phoneNo = $('#BoxPhoneNo').val();//手机号
                var hidHandUpload = $('#hidHandUpload').val(); //手持照片
                var hidupload = $('#hidupload').val(); //照片
                var healthCardID = $('#BoxHealthCardID').val(); //健康证ID
                var internalDepart = $('#BoxInternalDepart').val(); //内外部门
                var provinceCode = $('#BoxProvinceCode').val(); //省
                var cityCode = $('#BoxCityCode').val(); //市
                var idCard = $('#BoxIDCard').val(); //身份证号
                var password = $('#BoxPassword').val() == null || $('#BoxPassword').val() == "" ? "edaisong" : $('#BoxPassword').val(); //密码
                var bussinessID = $('#BoxBussinessID').val(); //所属门店

                if (trueName == "" || trueName == null) {  //姓名非空验证
                    $('#labBoxTrueName').show();
                    result = false;
                } else {
                    $('#labBoxTrueName').hide();
                }
                if (bussinessID == "" || bussinessID == null) {  //所属门店非空验证
                    $('#labBoxBussinessID').show();
                    result = false;
                } else {
                    $('#labBoxBussinessID').hide();
                }
                if (phoneNo == "" || phoneNo == null) {  //手机号非空验证
                    $('#labBoxPhoneNo').html("不能为空").show();
                    result = false;
                } else {
                    var myreg = /^((\+?86)|(\(\+86\)))?(1[0-9]{10)$/;
                    if (!myreg.test(phoneNo)) {  //手机号码格式验证
                        $('#labBoxPhoneNo').html("手机号格式不正确").show();
                        result = false;
                    } else {
                        $('#labBoxPhoneNo').hide();
                    }
                }
                if (hidHandUpload == "" || hidHandUpload == null) {  //手持照片
                    $('#labfileuploadHand').val("不能为空").show();
                    result = false;
                } else {
                    //$('#labfileuploadHand').hide();
                }
                if (hidupload == "" || hidupload == null) {  //照片
                    $('#labfileupload').val("不能为空").show();
                    result = false;
                } else {
                    //$('#labfileupload').hide();
                }


                if (provinceCode == "" || provinceCode == null || cityCode == "" || cityCode == null) {  //省/市非空验证
                    $('#labBoxCode').show();
                    result = false;
                } else {
                    $('#labBoxCode').hide();
                }
                if (healthCardID == "" || healthCardID == null) {  //健康证非空验证
                    $('#labHealthCardID').show();
                    result = false;
                } else {
                    $('#labHealthCardID').hide();
                }
                if (result == false) {
                    return result;
                } else {
                    $.ajax({
                        type: 'POST',
                        dataType: 'json',
                        url: '/SuperManManager/AddSuperMan',
                        data: {
                            TrueName: trueName, PhoneNo: phoneNo, HealthCardID: healthCardID, InternalDepart: internalDepart,
                            ProvinceCode: provinceCode, CityCode: cityCode, IDCard: idCard, Password: password, City: $("#BoxProvinceCode").find("option:selected").text(),
                            CityId: provinceCode, Province: $("#BoxProvinceCode").find("option:selected").text(), GroupId: $("#HidGroupID").val(),
                            BussinessID: bussinessID, PicWithHandUrl: hidHandUpload, PicUrl: hidupload
                        },
                        success: function (result) {
                            if (result.IsSuccess) {
                                alert("新增超人成功！");
                                window.location.href = "/SuperManManager/SuperManManager";
                            } else {
                                alert(result.Message);
                            }
                        },
                        error: function () {
                        }
                    });
                }
            }
         );

        //省下拉框下拉触发事件  add by caoheyang 20150302
        $('#BoxProvinceCode').change(function () {
            var selCityCode = $("#BoxCityCode");
            selCityCode.empty();  //清除选择的城市信息
            $('#BoxBussinessID').empty();  //清除选择的门店信息
            selCityCode.append('<option value="" selected="selected">--城市--</option>');
            if ($(this).val() != null && $(this).val() != "") {
                $.post("/Common/GetRegionsByCode", { Code: $(this).val() }, function (data) {
                    $.each(data, function (i, item) {
                        selCityCode.append('<option  value="' + item.Code + '">' + item.Name + '</option>');
                    });
                });
            }
        });

        //城市下拉框下拉触发事件  add by caoheyang 20150302
        $('#BoxCityCode').change(function () {
            LoadBussinessInfo();
        });

        //加载门店信息  add by caoheyang 20150303
        function LoadBussinessInfo() {
            var selBussinessID = $('#BoxBussinessID');  //清除选择的门店信息
            selBussinessID.empty();
            selBussinessID.append('<option value="" selected="selected">--所属门店--</option>');
            if ($('#BoxCityCode').val() != null && $('#BoxCityCode').val() != "") {
                $.post("/BusinessManager/GetBussinessByCityInfo",
                    { ProvinceCode: $("#BoxProvinceCode").val(), CityCode: $('#BoxCityCode').val(), GroupId: $("#HidGroupID").val() },
                    function (data) {
                        $.each(data, function (i, item) {
                            selBussinessID.append('<option  value="' + item.Id + '">' + item.Name + '</option>');
                        });
                    });
            }
        }


        $('#SupProvinceCode').change(function () {
            var selCityCode = $("#SupCityCode");
            selCityCode.empty();  //清除选择的城市信息
            $('#SupBussinessID').empty();  //清除选择的门店信息
            selCityCode.append('<option value="" >--城市--</option>');
            if ($(this).val() != null && $(this).val() != "") {
                $.post("/Common/GetRegionsByCode", { Code: $(this).val() }, function (data) {
                    $.each(data, function (i, item) {
                        selCityCode.append('<option  value="' + item.Code + '">' + item.Name + '</option>');
                    });
                    selCityCode.val(cityID);
                    selCityCode.change();
                });
            }
        });



        $('#SupCityCode').change(function () {
            LoadSupBussinessInfo();
        });
        function LoadSupBussinessInfo() {
            var selBussinessID = $('#SupBussinessID');  //清除选择的门店信息
            selBussinessID.empty();
            selBussinessID.append('<option value="" selected="selected">--所属门店--</option>');
            if ($('#SupCityCode').val() != null && $('#SupCityCode').val() != "") {
                $.post("/BusinessManager/GetBussinessByCityInfo",
                    { ProvinceCode: $("#SupProvinceCode").val(), CityCode: $('#SupCityCode').val(), GroupId: $("#HidGroupID").val() },
                    function (data) {
                        $.each(data, function (i, item) {
                            selBussinessID.append('<option  value="' + item.Id + '">' + item.Name + '</option>');
                        });
                        selBussinessID.val(bID);
                    });
            }
        }


        $("#btnUpdateSuperConfim").click(

    function () {
        if (confirm("确认要提交更改？")) {
            $('#labBoxSupName').hide();
            $('#labSupBussinessID').hide();
            $('#labBoxSupPhoneNo').hide();
            $('#labSupCityCode').hide();
            $('#labSupHealthCardID').hide();
            var result = true;//验证结果
            var id = $('#SupId').val();//Id
            var trueName = $('#SupName').val();//姓名
            var phoneNo = $('#SupPhoneNo').val();//手机号
            var hidHandUpload = $('#hidSupHandUpload').val(); //手持照片
            var hidupload = $('#hidSupupload').val(); //照片
            var healthCardID = $('#SupHealthCardID').val(); //健康证ID
            var internalDepart = $('#SupInternalDepart').val(); //内外部门
            var provinceCode = $('#SupProvinceCode').val(); //省
            alert(provinceCode);
            var cityCode = $('#SupCityCode').val(); //市
            var idCard = $('#SupIDCard').val(); //身份证号
            var password = $('#SupPassword').val(); //密码
            var bussinessID = $('#SupBussinessID').val(); //所属门店

            if (trueName == "" || trueName == null) {  //姓名非空验证
                $('#labBoxSupName').show();
                result = false;
            } else {
                $('#labBoxSupName').hide();
            }
            //if (bussinessID == "" || bussinessID == null) {  //所属门店非空验证
            //    $('#labSupBussinessID').show();
            //    result = false;
            //} else {
            //    $('#labSupBussinessID').hide();
            //}
            if (phoneNo == "" || phoneNo == null) {  //手机号非空验证
                $('#labBoxSupPhoneNo').html("不能为空").show();
                result = false;
            } else {
                var myreg = /^((\+?86)|(\(\+86\)))?(1[0-9][0-9]{9})$/;
                if (!myreg.test(phoneNo)) {  //手机号码格式验证
                    $('#labBoxSupPhoneNo').html("手机号格式不正确").show();
                    result = false;
                } else {
                    $('#labBoxSupPhoneNo').hide();
                }
            }
            if (provinceCode == "" || provinceCode == null || cityCode == "" || cityCode == null) {  //省/市非空验证
                $('#labSupCityCode').show();
                result = false;
            } else {
                $('#labSupCityCode').hide();
            }
            if (healthCardID == "" || healthCardID == null) {  //健康证非空验证
                $('#labSupHealthCardID').show();
                result = false;
            } else {
                $('#labSupHealthCardID').hide();
            }
            if (result == false) {
                return result;
            }
            else {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: '/SuperManManager/ModifySuperMan',
                    data: {
                        Id: id, TrueName: trueName, PhoneNo: phoneNo, HealthCardID: healthCardID, InternalDepart: internalDepart,
                        ProvinceCode: provinceCode, CityCode: cityCode, IDCard: idCard, Password: password, City: $("#SupCityCode").find("option:selected").text(),
                        CityId: cityCode, Province: $("#SupProvinceCode").find("option:selected").text(), GroupId: $("#HidSupGroupID").val(),
                        BussinessID: bussinessID, PicWithHandUrl: hidHandUpload, PicUrl: hidupload
                    },
                    success: function (result) {
                        if (result.IsSuccess) {
                            alert("修改超人信息成功！");
                            window.location.href = "/SuperManManager/SuperManManager";
                        } else {
                            alert(result.Message);
                        }
                    },
                    error: function () {
                    }
                });
            }
        }
    }
         );

        //当集团可选（即：当前登陆人员非管理员时，为集团下拉绑定事件  add by caoheyang 20150303）
        if ($("#HidGroupID").attr("type") != "hidden") {
            //当集团选项发生改变时，重选商户。
            $("#HidGroupID").change(function () {
                $('#BoxBussinessID').val("");
                LoadBussinessInfo();
            });
        }
        if ($("#HidSupGroupID").attr("type") != "hidden") {
            //当集团选项发生改变时，重选商户。
            $("#HidSupGroupID").change(function () {
                $('#SupBussinessID').val("");
                LoadSupBussinessInfo();
            });
        }
        //新增超人按钮点击事件   add by caoheyang 20150228
        $("#btnAdd").click(
            function () {
                adminjs.openwinbox('#AddSuperManShow');
            }
         );
    })
    ////分页
    art.ui.control.Pager.enablePaging(document, refresh);
    function refresh(pageIndex) {
        var url = "/SuperManManager/SuperManManager";
        if (pageIndex !== undefined) {
            criteria.PagingRequest.PageIndex = pageIndex;
        }
        criteria.status = $("#superManStatus").val();
        webExpress.utility.ajax.request
            (
                url,
                criteria,
                function (data) {
                    $("#dataList").html(data);
                });
    };
    $('.J_closebox').click(function () {
        adminjs.closewinbox('.add-openbox');
        return false;
    });
</script>
